#This file controls which keys and corresponding sub-keys and super-keys (contexts) are valid in the config files, names listed alphabetically
#A key may have more than one context, in which case the description and subkeys will be different for each context 
#The valid subkeys are divided into four categories: required, required_exclusive, optional, and codependent
# Format:
#    <the key>:      
#       - context: <the key under which this key is valid> 
#         description: <a description of the key in the current context>
#         subkeys: <a list of valid subkeys (if any) for this key in the current context>
#             required:            <all of these keys must be included>
#             required_exclusive:  <exactly one of these keys must be included (unless it contains any groups of codependent keys)>
#             optional:            <any of these keys may optionally be included>
#             codependent:         <if any of these keys are included, all of them must be included>

align_axis:
  - context: rotation
    description: "arguments for rotation_align_axis function"
    subkeys:
      required: [axis, vec, grounded_axis, flip]
      required_exclusive: []
      optional: [flip]
      codependent: []

body_frame:
  - context: body_frames
    description: "fixed frame attached to the sensor platform"
    subkeys:
      required: [id, transform]
      required_exclusive: []
      optional: []
      codependent: []

body_frames:
  - context: platform

bspline:
  - context: translation
    description:
    subkeys:
      required: [res, degree, span_time, control_points]
      required_exclusive: []
      optional: [] 
      codependent: []

subsample_interpolate:
  - context: translation
    description:
    subkeys:
      required: [super_id, control_point_rate, degree]
      required_exclusive: []
      optional: [translation_only, rotation_only]
      codependent: []

camera:
  - context: sensor
    description:
    subkeys:
      required: [height, width, intrinsics]
      required_exclusive: []
      optional: [distortion, transform]
      codependent: []

control_points:
  - context: bspline
    description:
    subkeys:
      required: []
      required_exclusive: [points, file]
      optional: []
      codependent: []

feature:
  - context: features
    description: "define a feature as a set of points and a color"
    subkeys:
      required: [id]
      required_exclusive: [points, random_points, planar_points]
      optional: [color]
      codependent: []
    
features:
  - context: scene

file:
  - context: trajectory
    description:
    subkeys:
      required: [path, format]
      required_exclusive: []
      optional: [time_unit, jpl] 
      codependent: []

id:
  - context: trajectory
    description: "name of the trajectory"
  - context: platform
    description: "name of the platform"
  - context: sensor
    description: "name of the sensor"
  - context: feature
    description: "name of the feature"
  - context: body_frame
    description: "name of the body frame"

imu:
  - context: sensor
    description:
    subkeys:
      required: [gyro_noise, gyro_bias, accel_noise, accel_bias]
      required_exclusive: []
      optional: []
      codependent: []

modify:
  - context: trajectory
    description: "modify a trajectory by scaling, shifting, and/or rotating about a point"
    subkeys:
      required_exclusive: []
      optional: [scale, shift, rotate_about_point]
      codependent: []

planar_points:
  - context: feature
    description:
    subkeys:
      required: [center, normal, radius]
      required_exclusive: [grid_spacing, num]
      optional: [frame_id]
      codependent: []

platform:
  - context: scene
    description:
    subkeys:
      required: [id, base_frame]
      required_exclusive: []
      optional: [sensors, body_frames]
      codependent: []

points:
  - context: feature
    description: "list of 3D points"

random_points:
  - context: feature
    description: "arguments for random_point_set function"
    subkeys:
      required: [center, radius, num]
      required_exclusive: []
      optional: []
      codependent: []

rotate_about_point:
  - context: trajectory
    description: 
    subkeys:
      required: [rotation]
      required_exclusive: []
      optional: [jpl, radians]
      codependent: []

rotation:
  - context: trajectory
    description: 
    subkeys:
      required: []
      required_exclusive: [align_axis, constant, bspline_so3]
      optional: []
      codependent: []
  - context: transform
    description: "x-y-z fixed-axis euler angles in degrees from base frame to this sensor frame"

scene:
  - context: # None because it's highest level key
    subkeys:
      required: [trajectory_group, platform]
      required_exclusive: []
      optional: [features]
      codependent: []

sensor:
  - context: sensors
    subkeys:
      required: [id, enable_measurements, rate]
      required_exclusive: [imu, camera]
      optional: [transform, time_offset]
      codependent: []

sensors:
  - context: platform

trajectory:
  - context: trajectory_group
    subkeys:
      required: [id]
      required_exclusive: [file, translation, rotation, subsample_interpolate, copy]
      optional: []
      optional: []
      codependent:
        - [translation, rotation]

trajectory_group:
  - context: scene
    subkeys:
      required: [reference, trajectories]
      required_exclusive: []
      optional: [main]
      codependent: []

transform:
  - context: sensor
    subkeys:
      required: [translation, rotation]
      required_exclusive: []
      optional: [from, jpl]
      codependent: []
  - context: body_frame
    subkeys:
      required: [translation, rotation]
      required_exclusive: []
      optional: [from, jpl]
      codependent: []
    
translation:
  - context: trajectory
    subkeys:
      required: []
      required_exclusive: [bspline, file, constant]
      optional: []
      codependent: []

vec:
  - context: align_axis
    subkeys:
      required: []
      required_exclusive: [point, current_trajectory]
      optional: [negate]
      codependent: []
    